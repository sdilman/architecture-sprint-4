## Анализ

Наиболее важными подсистемами с точки зрения внедрения трассировки являются следующие: CRM, CRM API, Message Queue, MES API, MES так как через них проходит процесс обслуживания заказа внешнего продавца на изготовление изделия. Именно такой процесс вызывает наибольшее количество жалоб на потерю заказа. 

Данные для сохранения в трассировочных сообщениях:
1. Уникальный идентификатор транзакции
2. Название шага операции и текущее состояние заказа.
3. Время начала и завершения шага операций
4. Коды ошибок если произошел сбой.
5. Идентификаторы пользователей или операторов, участвующих в процессе.
6. Метаданные запроса.


## Мотивация

Трассировка позволяет проследить путь выполнения каждого запроса. В случае получения жалобы на некорректную работу запроса (например при потере заказа), с помощью трассировки служба поддержки сможет увидеть в какой из подсистем произошел сбой данного конкретного запроса и принять меры для исправления ситуации как для данного запроса так и в целом.

## Предлагаемое решение

Добавим к подсистемам CRM, CRM API, MES API, MES промежуточный слой (middleware) дополняющий заголовки каждого запроса идентификатором трассировки
Добавим компонент Trace Manager. Он будет хранить и визуализировать информацию о каждом трейсе. Можно использовать имеющиеся решения, такие как OpenTelemetry. Для наблюдением за пересылкой сообщения через Message Queue можно добавить дополнительный слушатель, который будет связан с Trace Manager.

## Компромиссы

Для подсистем разработанных вне компании "Александрит" внедрение промежуточного слоя (middleware) может быть затруднительным.

## Меры безопасности

1. Аутентификация и авторизация в системе трейсинга.
2. Мониторинг и аудит доступа к системе трейсинга.
3. Ограничение на доступ к API системы трейсинга.
4. Использование VPN для доступа сотрудников к системе трейсинга.