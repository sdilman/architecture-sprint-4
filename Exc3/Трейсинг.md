## Анализ

Наиболее важными подсистемами с точки зрения внедрения трассировки являются следующие: CRM, CRM API, Message Queue, MES API, MES так как через них проходит процесс обслуживания заказа внешнего продавца на изготовление изделия. Именно такой процесс вызывает наибольшее количество жалоб на потерю заказа.

## Мотивация

Трассировка позволяет проследить путь выполнения каждого запроса. В случае получения жалобы на некорректную работу запроса (например при потере заказа), с помощью трассировки служба поддержки сможет увидеть в какой из подсистем произошел сбой данного конкретного запроса и принять меры для исправления ситуации как для данного запроса так и в целом.

## Предлагаемое решение

Добавим к подсистемам CRM, CRM API, MES API, MES промежуточный слой (middleware) дополняющий заголовки каждого запроса идентификатором трассировки
Добавим компонент Trace Manager. Он будет хранить и визуализировать информацию о каждом трейсе. Можно использовать имеющиеся решения, такие как OpenTelemetry. Для наблюдением за пересылкой сообщения через Message Queue можно добавить дополнительный слушатель, который будет связан с Trace Manager.

## Компромиссы

Для подсистем разработанных вне компании "Александрит" внедрение промежуточного слоя (middleware) может быть затруднительным.